services:
  nginx:
    image: nginx:latest
    container_name: nginx
    ports:
      - 80
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - ghost
      #- apache-answer

  ghost:
    image: ghost:latest
    container_name: ghost
    environment:
      url: http://localhost
      database__client: mysql
      database__connection__host: db-ghost
      database__connection__user: ghost_user
      database__connection__password: ghost_password
      database__connection__database: ghost_db
      database__connection__port: 3306
    depends_on:
      - db-ghost
    ports:
      - 2368

  # apache-answer:
  #   image: 01011001/qa:latest
  #   container_name: apache-answer
  #   ports:
  #     - 80
  #   volumes:
  #     - ./configs/config.yaml:/data/conf/config.yaml

  apache-answer:
    build:
      context: .
      dockerfile: ./Dockerfile
    container_name: apache-answer
    environment:
      DB_TYPE: mysql
      DB_HOST: db-answer
      DB_USERNAME: answer_user
      DB_PASSWORD: answer_password
      LANGUAGE: de_DE
      SITE_NAME: Community
      DB_NAME: answer_db
      ADMIN_NAME: admin
      ADMIN_EMAIL: cata.waack@gmail.com
      CONTACT_EMAIL: cata.waack@gmail.com
      ADMIN_PASSWORD: admin
      AUTO_INSTALL: false
    depends_on:
      - db-answer
    ports:
      - 9080
    volumes:
      - ./configs/config.yaml:/data/conf/config.yaml

  # mysql:
  #   image: mysql:latest
  #   container_name: mysql
  #   restart: always
  #   environment:
  #     MYSQL_ROOT_PASSWORD: root_password
  #     MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
  #   healthcheck:
  #     test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
  #     interval: 2s
  #     timeout: 1s
  #     retries: 3
  #   volumes:
  #     - mysql-data:/var/lib/mysql
  #     - ./mysql/init-scripts:/docker-entrypoint-initdb.d
  #   ports:
  #     - "3306:3306"

  db-ghost:
    image: mysql:latest
    environment:
      - MYSQL_ROOT_PASSWORD=root_password
      - MYSQL_DATABASE=ghost_db
      - MYSQL_USER=ghost_user
      - MYSQL_PASSWORD=ghost_password
    ports:
      - 3306
    volumes:
      - ghost-volume:/var/lib/postgresql/data

  db-answer:
    image: mysql:latest
    environment:
      - MYSQL_ROOT_PASSWORD=root_password
      - MYSQL_DATABASE=answer_db
      - MYSQL_USER=answer_user
      - MYSQL_PASSWORD=answer_password
    ports:
      - 3306
    volumes:
      - answer-volume:/var/lib/postgresql/data

volumes:
  #answer-data:
  #mysql-data:
  ghost-volume:
  answer-volume:
